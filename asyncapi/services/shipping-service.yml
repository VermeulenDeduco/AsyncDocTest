asyncapi: 3.0.0
info:
  title: Shipping Service
  version: 1.0.0
  description: >
    Handles all logic related to preparing and dispatching shipments. It
    operates on a request-reply basis with the Order Service.

channels:
  shipmentRequest:
    address: 'ecommerce/shipping/request'
    messages:
      ShipmentPreparationRequested:
        $ref: '#/components/messages/ShipmentPreparationRequested'

operations:
  onShipmentRequest:
    action: receive
    channel:
      $ref: '#/channels/shipmentRequest'

  sendShipmentReply:
    action: send
    messages:
      # CORRECTED: Points directly to the components section
      - $ref: '#/components/messages/ShipmentPrepared'

components:
  messages:
    ShipmentPreparationRequested:
      summary: A request to prepare an order for shipment.
      correlationId:
        location: '$message.header#/correlationId'
      payload:
        $ref: '../common/schemas/OrderPayload.yml'
      bindings:
        mqtt:
          responseTopic:
            type: string

    ShipmentPrepared:
      summary: A confirmation that the shipment has been prepared.
      correlationId:
        location: '$message.header#/correlationId'
      payload:
        type: object
        properties:
          orderId:
            type: string
          trackingNumber:
            type: string